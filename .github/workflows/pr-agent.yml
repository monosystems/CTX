name: MonoSystems PR Agent
on:
  pull_request:
    types: [opened, synchronize, reopened]
  issue_comment:
    types: [created]
permissions:
  contents: read
  pull-requests: write
  issues: write
jobs:
  pr_agent_job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR Agent
        uses: actions/checkout@v4
        with:
          repository: monosystems/pr-agent
          token: ${{ secrets.GH_PAT_TOKEN }}  # Personal Access Token mit repo scope
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      - name: Install PR Agent
        run: pip install -e .
      - name: Run PR Agent
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENROUTER_API_BASE: ${{ secrets.OPENROUTER_API_BASE }}
          OPENROUTER_KEY: ${{ secrets.OPENROUTER_KEY }}
          CONFIG_MODEL: "MiniMax-M2.1"
        run: |
          if [ "${{ github.event_name }}" == "pull_request" ]; then
            pr-agent --pr_url "${{ github.event.pull_request.html_url }}" review
          else
            pr-agent --pr_url "${{ github.event.comment.html_url }}" review
          fi
